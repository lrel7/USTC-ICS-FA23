.ORIG x3000
MAIN AND R0, R0, #0
ADD R0, R0, #4
LD R5, IN0
LD R6, STACK
AND R1, R1, #0
JSR REMOVE
TRAP x25
IN0 .FILL x3100
STACK .FILL x4000
XOR ADD R2, R0, #0
AND R3, R3, #0
ADD R3, R3, #1
XOR_LOOP ADD R2, R2, #-1
BRZ XOR_BODY
ADD R3, R3, R3
BR XOR_LOOP
XOR_BODY AND R4, R1, R3
BRZ XOR_Z
NOT R3, R3
ADD R3, R3, #1
ADD R1, R1, R3
BR XOR_RET
XOR_Z ADD R1, R1, R3
BR XOR_RET
XOR_RET RET
STORE ADD R5, R5, #1
STR R1, R5, #0
RET
REMOVE ADD R6, R6, #-1
STR R7, R6, #0
ADD R0, R0, #0
BRZ R_RET
ADD R0, R0, #-1
BRNP R_BODY
ADD R0, R0, #1
JSR XOR
JSR STORE
BR R_RET
R_BODY ADD R0, R0, #-1
JSR REMOVE
ADD R0, R0, #2
JSR XOR
JSR STORE
ADD R0, R0, #-2
JSR PUT
ADD R0, R0, #1
JSR REMOVE
ADD R0, R0, #1
R_RET LDR R7, R6, #0
ADD R6, R6, #1
RET
PUT ADD R6, R6, #-1
STR R7, R6, #0
ADD R0, R0, #0
BRZ P_RET
ADD R0, R0, #-1
BRNP P_BODY
ADD R0, R0, #1
JSR XOR
JSR STORE
BR P_RET
P_BODY JSR PUT
ADD R0, R0, #-1
JSR REMOVE
ADD R0, R0, #2
JSR XOR
JSR STORE
ADD R0, R0, #-2
JSR PUT
ADD R0, R0, #2
P_RET LDR R7, R6, #0
ADD R6, R6, #1
RET
.END